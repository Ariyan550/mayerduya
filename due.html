<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Due Manager</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #000;
      color: white;
      font-size: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    .center-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      margin-top: 20px;
    }
    .center-buttons a {
      font-size: 22px;
      font-weight: bold;
    }
    .total-due-card {
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
    }
    .total-due-card h4, .total-due-card h5 {
      font-weight: bold;
    }
    table.striped > thead th {
      border: 1px solid #888;
    }
    table.striped > tbody > tr:nth-child(odd) {
      background-color: rgba(255, 255, 255, 0.05);
    }
    .modal {
      color: black;
    }
    .input-field input {
      border: 1px solid #2c2c2c !important;
      color: #ffffff !important;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1) !important;
      padding: 8px !important;
      border-radius: 8px !important;
      margin-top: 10px!important;
    }
    
    .input-field #desc{
        color :white!important;
    } 
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="center-buttons">
      <a class="waves-effect waves-light btn" onclick="showForm()">Due Entry</a>
      <a class="waves-effect waves-light btn" onclick="showList()">Due List</a>
    </div>

    <div id="formSection" style="display: none;">
      <a class="btn red right" onclick="hideSections()">Close</a>
      <div class="input-field"><input type="date" id="date"><label for="date">Date</label></div>
      <div class="input-field"><input type="text" id="shop"><label for="shop">Shop Name</label></div>
      <div class="input-field"><input type="text" id="address"><label for="address">Address</label></div>
      <div class="input-field"><textarea id="desc" class="materialize-textarea"></textarea><label for="desc">Description</label></div>
      <div class="input-field"><input type="number" id="amount"><label for="amount">Amount</label></div>
      <div class="input-field"><input type="number" id="prev"><label for="prev">Previous Amount</label></div>
      <div class="input-field"><input type="number" id="total" readonly><label for="total">Total Due</label></div>
      <a class="btn green" onclick="submitData()">Submit</a>
    </div>

    <div id="listSection" style="display: none;">
      <a class="btn red right" onclick="hideSections()">Close</a>
      <div class="total-due-card">
        <h5>Total Due</h5>
        <h4 id="totalDue">0</h4>
      </div>
      <table class="striped highlight responsive-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Shop</th>
            <th>Amount</th>
            <th>Total Due</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="dueTable"></tbody>
      </table>
      <div class="pagination-container">
        <ul class="pagination" id="pagination"></ul>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      M.AutoInit();
    });

    const date = document.getElementById('date');
    const shop = document.getElementById('shop');
    const address = document.getElementById('address');
    const desc = document.getElementById('desc');
    const amount = document.getElementById('amount');
    const prev = document.getElementById('prev');
    const total = document.getElementById('total');
    const tableBody = document.getElementById('dueTable');
    const totalDue = document.getElementById('totalDue');
    const pagination = document.getElementById('pagination');

    let currentPage = 1;
    const rowsPerPage = 5;

    amount.addEventListener('input', updateTotal);
    prev.addEventListener('input', updateTotal);

    function updateTotal() {
      total.value = (+amount.value || 0) + (+prev.value || 0);
    }

    function showForm() {
      document.getElementById('formSection').style.display = 'block';
      document.getElementById('listSection').style.display = 'none';
      M.updateTextFields();
    }

    function showList() {
      document.getElementById('listSection').style.display = 'block';
      document.getElementById('formSection').style.display = 'none';
      renderTable();
    }

    function hideSections() {
      document.getElementById('formSection').style.display = 'none';
      document.getElementById('listSection').style.display = 'none';
    }

    function showToast(msg) {
      M.toast({html: msg, classes: 'rounded'});
    }

    function submitData() {
      if (!date.value || !shop.value || !address.value || !amount.value) {
        showToast('âš ï¸ Please fill in all required fields');
        return;
      }

      const entry = {
        id: Date.now(),
        date: date.value,
        shop: shop.value,
        address: address.value,
        desc: desc.value,
        amount: +amount.value,
        prev: +prev.value,
        total: +total.value,
      };
      let data = JSON.parse(localStorage.getItem('dues')) || [];
      data.push(entry);
      localStorage.setItem('dues', JSON.stringify(data));
      clearForm();
      showToast('âœ… Data saved successfully!');
    }

    function clearForm() {
      date.value = shop.value = address.value = desc.value = amount.value = prev.value = total.value = '';
      M.updateTextFields();
    }

    function renderTable() {
      let data = JSON.parse(localStorage.getItem('dues')) || [];
      tableBody.innerHTML = '';
      let totalSum = 0;
      let start = (currentPage - 1) * rowsPerPage;
      let paginatedItems = data.slice(start, start + rowsPerPage);

      paginatedItems.forEach((item) => {
        totalSum += item.total;
        let row = `<tr>
          <td data-label="Date">${item.date}</td>
          <td data-label="Shop">${item.shop}</td>
          <td data-label="Amount">${item.amount}</td>
          <td data-label="Total">${item.total}</td>
          <td data-label="Actions">
            <a class="btn-small yellow" onclick="editEntry(${item.id})">Edit</a>
            <a class="btn-small red" onclick="deleteEntry(${item.id})">Delete</a>
          </td>
        </tr>`;
        tableBody.innerHTML += row;
      });

      totalDue.innerText = data.reduce((acc, curr) => acc + curr.total, 0);
      renderPagination(data.length);
    }

    function renderPagination(totalItems) {
      pagination.innerHTML = '';
      let totalPages = Math.ceil(totalItems / rowsPerPage);

      for (let i = 1; i <= totalPages; i++) {
        let li = document.createElement('li');
        li.className = i === currentPage ? 'active' : 'waves-effect';
        li.innerHTML = `<a href="#" onclick="changePage(${i})">${i}</a>`;
        pagination.appendChild(li);
      }
    }

    function changePage(page) {
      currentPage = page;
      renderTable();
    }

    function deleteEntry(id) {
      let data = JSON.parse(localStorage.getItem('dues')) || [];
      data = data.filter(d => d.id !== id);
      localStorage.setItem('dues', JSON.stringify(data));
      renderTable();
      showToast('ðŸ—‘ï¸ Entry deleted');
    }

    function editEntry(id) {
      const data = JSON.parse(localStorage.getItem('dues')) || [];
      const item = data.find(d => d.id === id);
      if (item) {
        showForm();
        date.value = item.date;
        shop.value = item.shop;
        address.value = item.address;
        desc.value = item.desc;
        amount.value = item.amount;
        prev.value = item.prev;
        updateTotal();
        M.updateTextFields();
        deleteEntry(id);
      }
    }
  </script>
</body>
</html>
