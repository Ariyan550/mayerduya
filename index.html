<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>মোম ও চক বিক্রয় ব্যবস্থাপনা</title>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">

  <h1 class="text-3xl font-bold mb-6 text-center">মোম ও ইংলিশ চক বিক্রয় ব্যবস্থাপনা</h1>

  <!-- দোকান তালিকা -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">দোকান তালিকা</h2>
    <input id="shopSearch" type="text" placeholder="দোকান খুঁজুন..." class="border p-2 rounded w-full mb-2" />
    <ul id="shopList" class="mb-2 max-h-32 overflow-auto border rounded p-2 bg-gray-50"></ul>
    <input id="newShopName" type="text" placeholder="নতুন দোকানের নাম" class="border p-2 rounded w-full mb-2" />
    <input id="newShopMobile" type="text" placeholder="মোবাইল নম্বর" class="border p-2 rounded w-full mb-2" />
    <input id="newShopAddress" type="text" placeholder="ঠিকানা" class="border p-2 rounded w-full mb-2" />
    <button id="addShopBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">দোকান যোগ করুন</button>
  </section>

  <!-- মোম বিক্রয় -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">মোম বিক্রয়</h2>
    <select id="saleShop" class="border p-2 rounded w-full mb-2"></select>
    <input id="saleKg" type="number" step="0.01" placeholder="কেজি" class="border p-2 rounded w-full mb-2" />
    <input id="saleTk" type="number" step="0.01" placeholder="টাকা" class="border p-2 rounded w-full mb-2" />
    <input id="profitTk" type="number" step="0.01" placeholder="লাভ" class="border p-2 rounded w-full mb-2" />
    <input id="saleDate" type="date" class="border p-2 rounded w-full mb-2" />
    <button onclick="addWaxSale()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">মোম বিক্রয় যোগ করুন</button>
    <h3 class="mt-4 font-semibold">আজকের মোম বিক্রয়:</h3>
    <ul id="todaySales" class="max-h-32 overflow-auto bg-gray-50 border rounded p-2"></ul>
  </section>

  <!-- ইংলিশ চক বিক্রয় -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">ইংলিশ চক বিক্রয়</h2>
    <select id="chalkShop" class="border p-2 rounded w-full mb-2"></select>
    <input id="chalkQty" type="number" placeholder="পরিমাণ (পিস)" class="border p-2 rounded w-full mb-2" />
    <input id="chalkTk" type="number" step="0.01" placeholder="টাকা" class="border p-2 rounded w-full mb-2" />
    <input id="chalkProfit" type="number" step="0.01" placeholder="লাভ" class="border p-2 rounded w-full mb-2" />
    <input id="chalkDate" type="date" class="border p-2 rounded w-full mb-2" />
    <button onclick="addChalkSale()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">চক বিক্রয় যোগ করুন</button>
    <h3 class="mt-4 font-semibold">মোট বিক্রয়:</h3>
    <div id="chalkSummary" class="bg-gray-50 border rounded p-2"></div>
  </section>

  <!-- ব্যয় -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">ব্যয়</h2>
    <input id="expenseAmount" type="number" step="0.01" placeholder="টাকা" class="border p-2 rounded w-full mb-2" />
    <input id="memo" type="text" placeholder="মেমো" class="border p-2 rounded w-full mb-2" />
    <input id="ieDate" type="date" class="border p-2 rounded w-full mb-2" />
    <button onclick="addExpense()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ব্যয় যোগ করুন</button>
    <button onclick="showMonthlyExpense()" class="mt-2 bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">মাসিক ব্যয় দেখুন</button>
    <div id="monthlyExpense" class="mt-2 font-semibold"></div>
  </section>

  <!-- বকেয়া হিসাব -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">বকেয়া হিসাব</h2>
    <select id="dueShop" class="border p-2 rounded w-full mb-2"></select>
    <input id="dueAmount" type="number" step="0.01" placeholder="টাকা (+বকেয়া, -পেমেন্ট)" class="border p-2 rounded w-full mb-2" />
    <button onclick="updateDue()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">বকেয়া আপডেট করুন</button>
    <h3 class="mt-4 font-semibold">বকেয়া তালিকা:</h3>
    <ul id="dueList" class="max-h-32 overflow-auto bg-gray-50 border rounded p-2"></ul>
  </section>

  <!-- কর্মচারী ব্যবস্থাপনা -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">কর্মচারী ব্যবস্থাপনা</h2>
    <input id="empName" type="text" placeholder="নাম" class="border p-2 rounded w-full mb-2" />
    <input id="empMobile" type="text" placeholder="মোবাইল" class="border p-2 rounded w-full mb-2" />
    <input id="empSalary" type="number" step="0.01" placeholder="বেতন" class="border p-2 rounded w-full mb-2" />
    <button onclick="addEmployee()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">কর্মচারী যোগ করুন</button>

    <table class="w-full mt-4 border-collapse border border-gray-300">
      <thead>
        <tr class="bg-gray-200">
          <th class="border border-gray-300 px-4 py-2">নাম</th>
          <th class="border border-gray-300 px-4 py-2">মোবাইল</th>
          <th class="border border-gray-300 px-4 py-2">বেতন</th>
        </tr>
      </thead>
      <tbody id="employeeList" class="text-center"></tbody>
    </table>
  </section>

  <!-- মাসিক রিপোর্ট ও পিডিএফ -->
  <section class="mb-8 bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">মাসিক রিপোর্ট</h2>
    <button onclick="generateMonthlyReport()" class="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 mb-2">রিপোর্ট তৈরি করুন</button>
    <button onclick="downloadPDF()" class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900 mb-4">পিডিএফ ডাউনলোড করুন</button>
    <div id="monthlyReport" class="border p-4 rounded bg-gray-50 whitespace-pre-line"></div>
  </section>

<script>
  // দোকান ডাটা ও ফাংশন
  let shops = JSON.parse(localStorage.getItem('shops') || '[]');

  function saveShops() {
    localStorage.setItem('shops', JSON.stringify(shops));
  }

  function renderShopList(filter = '') {
    const ul = document.getElementById('shopList');
    ul.innerHTML = '';
    const filtered = shops.filter(s => s.name.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(shop => {
      const li = document.createElement('li');
      li.className = "flex justify-between items-center border-b py-1";
      li.innerHTML = `<span>${shop.name} - ${shop.mobile} - ${shop.address}</span>
        <button onclick="deleteShop(${shop.id})" class="text-red-600 hover:text-red-800">মুছুন</button>`;
      ul.appendChild(li);
    });
    populateShopSelects();
  }

  function addShop() {
    const name = document.getElementById('newShopName').value.trim();
    const mobile = document.getElementById('newShopMobile').value.trim();
    const address = document.getElementById('newShopAddress').value.trim();

    if (!name) {
      alert('দোকানের নাম দিন');
      return;
    }

    shops.push({ id: Date.now(), name, mobile, address });
    saveShops();
    document.getElementById('newShopName').value = '';
    document.getElementById('newShopMobile').value = '';
    document.getElementById('newShopAddress').value = '';
    renderShopList();
  }

  function deleteShop(id) {
    if(!confirm('আপনি কি এই দোকান মুছে ফেলতে চান?')) return;
    shops = shops.filter(s => s.id !== id);
    saveShops();
    renderShopList();
    loadTodaySales();
    loadDueList();
  }

  // দোকান সিলেক্ট অপশন আপডেট
  function populateShopSelects() {
    const saleShop = document.getElementById('saleShop');
    const chalkShop = document.getElementById('chalkShop');
    const dueShop = document.getElementById('dueShop');
    [saleShop, chalkShop, dueShop].forEach(select => {
      select.innerHTML = '<option value="">দোকান নির্বাচন করুন</option>';
      shops.forEach(shop => {
        const option = document.createElement('option');
        option.value = shop.id;
        option.textContent = shop.name;
        select.appendChild(option);
      });
    });
  }

  // মোম বিক্রয় ডাটা ও ফাংশন
  let waxSales = JSON.parse(localStorage.getItem('waxSales') || '[]');
  function saveWaxSales() {
    localStorage.setItem('waxSales', JSON.stringify(waxSales));
  }
  function addWaxSale() {
    const shopId = document.getElementById('saleShop').value;
    const kg = parseFloat(document.getElementById('saleKg').value);
    const tk = parseFloat(document.getElementById('saleTk').value);
    const profit = parseFloat(document.getElementById('profitTk').value);
    const date = document.getElementById('saleDate').value;

    if (!shopId || isNaN(kg) || isNaN(tk) || isNaN(profit) || !date) {
      alert('সঠিক তথ্য দিন');
      return;
    }

    waxSales.push({ id: Date.now(), shopId, kg, tk, profit, date });
    saveWaxSales();
    alert('মোম বিক্রয় তথ্য সংরক্ষিত হয়েছে');
    document.getElementById('saleKg').value = '';
    document.getElementById('saleTk').value = '';
    document.getElementById('profitTk').value = '';
    document.getElementById('saleDate').value = '';
    loadTodaySales();
  }

  // আজকের মোম বিক্রয় লোড
  function loadTodaySales() {
    const today = new Date().toISOString().slice(0, 10);
    const ul = document.getElementById('todaySales');
    ul.innerHTML = '';

    const todaySalesList = waxSales.filter(sale => sale.date === today);

    todaySalesList.forEach(sale => {
      const shop = shops.find(s => s.id == sale.shopId);
      const li = document.createElement('li');
      li.textContent = `${shop ? shop.name : 'অজানা দোকান'} - ${sale.kg} কেজি - ৳${sale.tk} - লাভ: ৳${sale.profit}`;
      ul.appendChild(li);
    });
  }

  // ইংলিশ চক বিক্রয় ডাটা ও ফাংশন
  let chalkSales = JSON.parse(localStorage.getItem('chalkSales') || '[]');
  function saveChalkSales() {
    localStorage.setItem('chalkSales', JSON.stringify(chalkSales));
  }
  function addChalkSale() {
    const shopId = document.getElementById('chalkShop').value;
    const qty = parseInt(document.getElementById('chalkQty').value);
    const tk = parseFloat(document.getElementById('chalkTk').value);
    const profit = parseFloat(document.getElementById('chalkProfit').value);
    const date = document.getElementById('chalkDate').value;

    if (!shopId || isNaN(qty) || isNaN(tk) || isNaN(profit) || !date) {
      alert('সঠিক তথ্য দিন');
      return;
    }

    chalkSales.push({ id: Date.now(), shopId, qty, tk, profit, date });
    saveChalkSales();
    alert('ইংলিশ চক বিক্রয় তথ্য সংরক্ষিত হয়েছে');
    document.getElementById('chalkQty').value = '';
    document.getElementById('chalkTk').value = '';
    document.getElementById('chalkProfit').value = '';
    document.getElementById('chalkDate').value = '';
    loadChalkSummary();
  }

  function loadChalkSummary() {
    const summaryDiv = document.getElementById('chalkSummary');
    const totalQty = chalkSales.reduce((sum, s) => sum + s.qty, 0);
    const totalTk = chalkSales.reduce((sum, s) => sum + s.tk, 0);
    const totalProfit = chalkSales.reduce((sum, s) => sum + s.profit, 0);

    summaryDiv.textContent = `মোট চক বিক্রি: ${totalQty} পিস, মোট বিক্রয়: ৳${totalTk.toFixed(2)}, মোট লাভ: ৳${totalProfit.toFixed(2)}`;
  }

  // ব্যয় ডাটা ও ফাংশন
  let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
  function saveExpenses() {
    localStorage.setItem('expenses', JSON.stringify(expenses));
  }
  function addExpense() {
    const amount = parseFloat(document.getElementById('expenseAmount').value);
    const memo = document.getElementById('memo').value.trim();
    const date = document.getElementById('ieDate').value;

    if (isNaN(amount) || !date) {
      alert('সঠিক তথ্য দিন');
      return;
    }

    expenses.push({ id: Date.now(), amount, memo, date });
    saveExpenses();
    alert('ব্যয় সংরক্ষিত হয়েছে');
    document.getElementById('expenseAmount').value = '';
    document.getElementById('memo').value = '';
    document.getElementById('ieDate').value = '';
  }

  function showMonthlyExpense() {
    const monthlyExpenseDiv = document.getElementById('monthlyExpense');
    const month = prompt('মাসের সংখ্যা লিখুন (যেমন 2023-06):');
    if (!month) return;

    const total = expenses
      .filter(e => e.date.startsWith(month))
      .reduce((sum, e) => sum + e.amount, 0);

    monthlyExpenseDiv.textContent = `${month} মাসের মোট ব্যয়: ৳${total.toFixed(2)}`;
  }

  // মাসিক রিপোর্ট তৈরি
  function generateMonthlyReport() {
    const month = prompt('মাসের সংখ্যা লিখুন (যেমন 2023-06):');
    if (!month) return;

    const monthlyWaxSales = waxSales.filter(sale => sale
